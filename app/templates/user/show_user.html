{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block app_content %}
  <table style="margin-bottom: 2rem;">
    <tr>
      <td rowspan="2">
        <img src="{{ user.profile.avatar }}" style="margin-right: 2rem;">
      </td>
      <td>
        <h1 style="margin-top: 0;">{{ user.username }}{% if user.type == 'official' %}<span class="badge" style="margin: 0 1rem; color: #fff; background-color: #5cb85c; border-color: #4cae4c;">Official</span>{% endif %}</h1>
      </td>
    </tr>
    <tr>
      <td>
        <a href="{{ url_for('user.show_profile', id=user.id) }}" class="btn btn-primary" style="margin-right: 0.5rem;">Profile</a>
        <a href="{{ url_for('user.show_stars', id=user.id) }}" class="btn btn-primary" style="margin-right: 0.5rem;">Stars</a>
        {% if current_user.is_authenticated and user != current_user %}
          {% if not current_user.is_following(user) %}
            <a href="{{ url_for('user.follow', id=user.id) }}" class="btn btn-primary" style="margin-right: 0.5rem;">Follow</a>
          {% else %}
            <a href="{{ url_for('user.unfollow', id=user.id) }}" class="btn btn-primary" style="margin-right: 0.5rem;">Unfollow</a>
          {% endif %}
        {% endif %}
        {% if current_user.is_authenticated and user == current_user %}
          <a href="{{ url_for('user.settings') }}" class="btn btn-primary" style="margin-right: 0.5rem">Settings</a>
        {% endif %}
      </td>
    </tr>
  </table>

  <div style="margin: 1.5rem 0; padding: 1rem; box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.3);">
    <div>{{ user.followers.count() }} followers</div>
    {% if user.followers.count() > 0 %}
      <ul class="list-group">
        {% for follower in user.followers %}
          <li class="list-group-item"><a href="{{ url_for('user.show_user', id=follower.id) }}">{{ follower.username }}</a></li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>

  <div style="margin: 1.5rem 0; padding: 1rem; box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.3);">
    <div>{{ user.followings.count() }} followings</div>
    {% if user.followings.count() > 0 %}
      <ul class="list-group">
        {% for following in user.followings %}
          <li class="list-group-item"><a href="{{ url_for('user.show_user', id=following.id) }}">{{ following.username }}</a></li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>

  {% if current_user.is_authenticated and user == current_user %}
    <div style="margin: 1.5rem 0; padding: 1rem; box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.3);">
      <a href="{{ url_for('mail.mailbox') }}" class="btn btn-primary" style="padding: 0.4rem 0.9rem;">Mailbox</a>
      <span style="margin-left: 1rem;">{{ current_user.received_mails.filter_by(read=1).count() }} unread</span>
    </div>
  {% endif %}

  <div style="margin: 1.5rem 0; padding: 1rem; box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.3);">
    <div>
      {% if current_user.is_authenticated and user == current_user %}
        <span>{{ user.posts.count() }} posts</span>
        <span style="margin: 0 1rem;"><a class="btn btn-primary" style="padding: 0.2rem 0.7rem" href="{{ url_for('post.new_post') }}">New</a></span>
      {% else %}
        {{ user.posts.count() }} posts
      {% endif %}
    </div>
    {% if user.posts.count() > 0 %}
      <ul class="list-group" style="margin: 1rem 0;">
        {% for post in user.posts %}
          <li class="list-group-item"><a href="{{ url_for('post.show_post', id=post.id) }}">{{ post.title }}</a></li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
{% endblock %}
